@* Reusable component for a simple interface to create new albums and folders *@
<link href="/css/components/CollectionCreator.css" rel="stylesheet">

<div id="collectionCreator">
    <button class="iconBtn" @onclick="@NewCollectionBtnClick" title="@newCollectionBtnTitle"><span class="material-icons-outlined">@newCollectionBtnIcon</span></button>
    
    @if (acceptingInput)
    {
        <input type="text" placeholder="@($"Enter new {(folder ? "folder" : "album")} name")" @bind="@NewCollectionName"/>

        if (!String.IsNullOrWhiteSpace(errorIconTitle))
        {
            <span title="@errorIconTitle" id="error" class="material-icons-outlined">error_outline</span>
        }
        
        <button class="iconBtn" @onclick="@ConfirmBtnClick"><span class="material-icons-outlined">check</span></button>
        
        <div>
            <input type="checkbox" id="folder" @bind="@folder">
            <label for="folder">Folder</label>
        </div>
    }
</div>

@code {
    [Parameter, EditorRequired]
    public List<Collection> Collections { get; set; } = null!;

    public event EventHandler? CollectionCreated;

    private string newCollectionBtnTitle = "New Collection", errorIconTitle = "", newCollectionBtnIcon = "library_add";
    public string NewCollectionName { get; private set; } = "";
    private bool acceptingInput, folder;
    private bool AcceptingInput
    {
        get => acceptingInput;
        set
        {
            acceptingInput = value;
            if (acceptingInput)
            {
                newCollectionBtnTitle = "Cancel";
                newCollectionBtnIcon = "close";
            }
            else
            {
                newCollectionBtnTitle = "New Collection";
                newCollectionBtnIcon = "library_add";
                NewCollectionName = errorIconTitle = "";
            }
        }
    }

    private void NewCollectionBtnClick() => AcceptingInput = !AcceptingInput;
    
    public void ConfirmBtnClick()
    {
        if (String.IsNullOrWhiteSpace(NewCollectionName))
        {
            errorIconTitle = "Provide Name for Collection";
            return;
        }
        
        if (Collections.Select(c => c.name).Contains(NewCollectionName))
        {
            errorIconTitle = "Collection Name in Use";
            return;
        }

        C.CreateCollection(NewCollectionName, folder);
        CollectionCreated?.Invoke(this, EventArgs.Empty);
        AcceptingInput = folder = false;
    }
}