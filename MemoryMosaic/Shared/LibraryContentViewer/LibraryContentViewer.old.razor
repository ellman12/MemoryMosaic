@* Component used in Index, Starred, CollectionView, No Date Taken, and Trash for displaying items in the MM library in small chunks at a time, as well as other shared behavior like showing prompts when deleting items, etc. *@
@* More content is added when mouse enters the top or bottom of the screen, as long as there is more content with date taken before/after the content already loaded. *@
@* The default amount of items loaded at a time is 50. *@
@* If it can't find any content, it shows an h1 saying no content. *@

@* @inherits Component *@
@* @using System.IO.Compression *@
@* @inject IJSRuntime JSRuntime *@
@* @inject NavigationManager navigationManager *@
@* <link href="css/Components/ViewItem.css" rel="stylesheet"/> *@
@* <link href="css/Components/LibraryContentViewer.css" rel="stylesheet"/> *@
@* *@
@* @if (MediaList.Count == 0) *@
@* { *@
@* 	<h1>@NoItemsText</h1> *@
@* 	return; *@
@* } *@
@* *@
@* $1$ Display a single item in full screen, and allow moving left/right in the List. #1# *@
@* <div id="viewDiv" style="visibility: @(SelectedItem == Guid.Empty ? "hidden" : "visible")"> *@
@* 	<div id="buttons"> *@
@* 	    <IconButton Icon="info" OnClick="@info.Toggle"/> *@
@* 		<IconButton Icon="trash" OnClick="@DeleteBtnClick"/> *@
@* 		<IconButton Icon="@(MediaList[viewIndex].starred ? "star" : "star_outline")" OnClick="@StarBtnClick" Title="@(MediaList[viewIndex].starred ? "Remove Star" : "Add Star")"/> *@
@* *@
@* 	    @if (Collection is {readOnly: false } && !MediaList[viewIndex].video) *@
@* 	    { *@
@* 	        <IconButton Icon="collections" OnClick="@(() => C.UpdateCollectionCover(Collection.Id, MediaList[viewIndex].path))" Title="Use As Collection Cover"/> *@
@* 	    } *@
@* 	</div> *@
@* *@
@* 	<div id="infoDiv" style="@info.Style"> *@
@* 		<div id="itemInfo"> *@
@* 			<div class="dataDiv" title="Date Taken"> *@
@* 				<svg width="24px" height="24px" class="v1262d JUQOtc Y0p3Ue" viewBox="0 0 24 24"><path d="M19 3h-1V1h-2v2H8V1H6v2H5a2 2 0 0 0-2 2v14a2 2 0 0 0 2 2h14c1.1 0 2-.9 2-2V5c0-1.1-.9-2-2-2zm0 16H5V8h14v11zM9 9.5a2.5 2.5 0 0 0 0 5 2.5 2.5 0 0 0 0-5z"></path></svg> *@
@* 				<span>@(MediaList[viewIndex].dateTaken == null ? "No Date Taken" : MediaList[viewIndex].dateTaken?.ToString("ddd, MMM d, yyyy h:mm:ss tt"))</span> *@
@* 				<IconButton Icon="edit" OnClick="@dateEdit.Enable"/> *@
@* 			</div> *@
@* *@
@* 			<div class="dataDiv" title="Date Added"> *@
@* 				<svg width="24px" height="24px" class="v1262d JUQOtc Y0p3Ue" viewBox="0 0 24 24"><path d="M19 3h-1V1h-2v2H8V1H6v2H5a2 2 0 0 0-2 2v14a2 2 0 0 0 2 2h14c1.1 0 2-.9 2-2V5c0-1.1-.9-2-2-2zm0 16H5V8h14v11zM9 9.5a2.5 2.5 0 0 0 0 5 2.5 2.5 0 0 0 0-5z"></path></svg> *@
@* 				<span>@MediaList[viewIndex].dateAdded.ToString("ddd, MMM d, yyyy h:mm:ss tt")</span> *@
@* 			</div> *@
@* *@
@* 			<div class="dataDiv"> *@
@* 				<svg width="24px" height="24px" class="v1262d JUQOtc Y0p3Ue" viewBox="0 0 24 24"><path d="M19 3H5c-1.1 0-2 .9-2 2v14c0 1.1.9 2 2 2h14c1.1 0 2-.9 2-2V5c0-1.1-.9-2-2-2zm0 16H5V5h14v14zm-5-7l-3 3.72L9 13l-3 4h12l-4-5z"></path></svg> *@
@* 				<span id="filenameInput">@Path.GetFileName(MediaList[viewIndex].path)</span> *@
@* 				<IconButton Icon="edit" OnClick="@editFilename.Enable"/> *@
@* 			</div> *@
@* *@
@* 			<textarea @bind="@itemDescription" @onfocusout="@UpdateDescription" autocomplete="off" autocorrect="on" placeholder="Enter a description for this item." spellcheck="true"></textarea> *@
@* 		</div> *@
@* *@
@* 		@if (collectionsIn?.Count > 0) *@
@* 		{ *@
@* 			<div id="collectionsInfo"> *@
@* 				<span id="collectionsText">Collections Containing</span> *@
@* 				<div id="collectionsIn"> *@
@* 					@foreach (Collection collection in collectionsIn) *@
@* 					{ *@
@* 						<a href="/collection-view/@collection.Id"> *@
@* 							<div class="collection"> *@
@* 								<div class="coverDiv"> *@
@* 									<img class="cover" src="mm_library/@collection.Cover" alt=""> *@
@* 								</div> *@
@* 								<span title="@collection.Name">@collection.Name</span> *@
@* 							</div> *@
@* 						</a> *@
@* 					} *@
@* 				</div> *@
@* 			</div> *@
@* 		} *@
@* 	</div> *@
@* *@
@* 	<div class="inputBox" style="@dateEdit.Style"> *@
@* 	    <span>Enter new date taken:</span> *@
@* 	    <input title="" type="datetime-local" @bind="@newDateTaken" step="1"/> *@
@* 	    <span class="errorSpan" style="@dtError.Style">Error Changing Date Taken</span> *@
@* 	    <div> *@
@* 	        <IconButton Icon="close" OnClick="@dateEdit.Enable"/> *@
@* 	        <IconButton Icon="check" OnClick="@UpdateDateTaken"/> *@
@* 	    </div> *@
@* 	</div> *@
@* *@
@* 	<div class="inputBox" style="@editFilename.Style"> *@
@* 	    <span>Enter new filename:</span> *@
@* 		<TextInput @bind-Input="@newFilename"/> *@
@* 	    <span class="errorSpan" style="@filenameError.Style">A file with the same Date Taken and/or name already exists.</span> *@
@* 	    <div> *@
@* 	        <IconButton Icon="close" OnClick="@(() => { editFilename.Disable(); filenameError.Disable(); newFilename = ""; })"/> *@
@* 	        <IconButton Icon="check" OnClick="@RenameFile"/> *@
@* 	    </div> *@
@* 	</div> *@
@* *@
@* 	<IconButton ID="backBtn" Icon="keyboard_backspace" OnClick="@(() => SelectedItem = Guid.Empty)"/> *@
@* *@
@* 	$1$ Only show the left button if there's more stuff that can be loaded. #1# *@
@* 	@if (viewIndex == 0) { viewIndex = AddContentTop(); } *@
@* 	@if (viewIndex > 0) *@
@* 	{ *@
@* 	    <div @onclick="@ChangeItemLeft" class="sideBtn" id="leftBtn"> *@
@* 	        <svg width="36px" height="36px" viewBox="0 0 24 24"><path d="M15.41 16.09l-4.58-4.59 4.58-4.59L14 5.5l-6 6 6 6z"></path></svg> *@
@* 	    </div> *@
@* 	} *@
@* *@
@* 	@if (!MediaList[viewIndex].video) *@
@* 	{ *@
@* 	    <div tabindex="0" id="itemDiv"><img src="mm_library/@MediaList[viewIndex].path" alt=""/></div> *@
@* 	} *@
@* 	else *@
@* 	{ *@
@* 	    <div id="itemDiv"><video src="@(SelectedItem == Guid.Empty ? "" : Path.Combine("mm_library", MediaList[viewIndex].path))" loop autofocus controls autoplay></video></div> *@
@* 	} *@
@* *@
@* 	$1$ Last item in the List so far so try adding more. If no more content can be added, don't show next button. #1# *@
@* 	@if (viewIndex == MediaList.Count - 1) { AddContentBottom(); } *@
@* 	@if (MediaList.Count - 1 > viewIndex) *@
@* 	{ *@
@* 	    <div @onclick="@ChangeItemRight" class="sideBtn" id="rightBtn"> *@
@* 	        <svg width="36px" height="36px" viewBox="0 0 24 24"><path d="M8.59 16.34l4.58-4.59-4.58-4.59L10 5.75l6 6-6 6z"></path></svg> *@
@* 	    </div> *@
@* 	} *@
@* </div> *@
@* *@
@* <main> *@
@* 	<div id="moreContentTopDiv" style="@moreContentTopDiv.Style" @onmouseover="@(() => AddContentTop())" @onscroll="@(() => AddContentTop())" @onmousewheel="@(() => AddContentTop())" @onpointerenter="@(() => AddContentTop())" @ontouchenter="@(() => AddContentTop())"></div> *@
@* 	@for (int i = 0; i < MediaList.Count; i++) *@
@* 	{ *@
@* 		if (MediaList[i].dateTaken == null) *@
@* 		{ *@
@* 			<div class="spanAndRow"> *@
@* 				<span>No Date Taken</span> *@
@* 				<div class="row"> *@
@* 					@do *@
@* 					{ *@
@* 						int ii = i; *@
@* 						<div class="thumbnail"> *@
@* 							@if (MediaList[ii].starred) { <MaterialIcon Icon="star" Class="star-icon"/> } *@
@*                             @if (MediaList[ii].video) { <MaterialIcon Icon="play_circle_outline" Class="video-icon"/> } *@
@* 							<span @onclick="@(mouseEventArgs => CheckClicked(MediaList[ii].uuid, mouseEventArgs))" itemid="@i" id="@MediaList[ii].uuid" class="material-icons checkbox unchecked">check_circle</span> *@
@* 							<img @onclick="@(mouseEventArgs => ImgClicked(MediaList[ii].uuid, ii, mouseEventArgs))" src="data:image/jpg;base64,@MediaList[ii].thumbnail" alt="mm_library/@MediaList[ii].path" loading="lazy"/> *@
@* 						</div> *@
@* 						i++; *@
@* 					} while (i < MediaList.Count && MediaList[i].dateTaken == null); *@
@* 					@{ i--; } $1$ This is kind of stupid but fixes an issue where it would skip some items. #1# *@
@* 				</div> *@
@* 			</div> *@
@* 		} *@
@* 		else if (MediaList[i].dateTaken != null && MediaList[i].dateTaken!.Value.Day != previousDay) *@
@* 		{ *@
@* 			<div class="spanAndRow"> *@
@* 				<span>@(UseDateAdded ? MediaList[i].dateAdded.ToString("ddd, MMM d, yyyy") : MediaList[i].dateTaken!.Value.ToString("ddd, MMM d, yyyy"))</span> *@
@* 				<div class="row"> *@
@* 					@{ *@
@* 						do *@
@* 						{ *@
@* 							int ii = i; *@
@* 							<div class="thumbnail"> *@
@* 								@if (MediaList[ii].starred) { <MaterialIcon Icon="star" Class="star-icon"/> } *@
@*                                 @if (MediaList[ii].video) { <MaterialIcon Icon="play_circle_outline" Class="video-icon"/> } *@
@* 								<span @onclick="@(mouseEventArgs => CheckClicked(MediaList[ii].uuid, mouseEventArgs))" itemid="@i" id="@MediaList[ii].uuid" class="material-icons checkbox unchecked">check_circle</span> *@
@* 								<img @onclick="@(mouseEventArgs => ImgClicked(MediaList[ii].uuid, ii, mouseEventArgs))" src="data:image/jpg;base64,@MediaList[ii].thumbnail" alt="mm_library/@MediaList[ii].path" loading="lazy"/> *@
@* 							</div> *@
@* 							if (i == MediaList.Count) *@
@* 							{previousDay = UseDateAdded ? MediaList[i - 1].dateAdded.Day : MediaList[i - 1].dateTaken!.Value.Day; *@
@* 							} *@
@* 							else *@
@* 								previousDay = UseDateAdded ? MediaList[i].dateAdded.Day : MediaList[i].dateTaken!.Value.Day; *@
@* 							i++; *@
@* 						} while (i < MediaList.Count && MediaList[i].dateTaken != null && previousDay == (UseDateAdded ? MediaList[i].dateAdded.Day : MediaList[i].dateTaken!.Value.Day)); *@
@* 						i--; *@
@* 					} *@
@* 				</div> *@
@* 			</div> *@
@* 		} *@
@* 	} *@
@* *@
@* 	<div id="moreContentBottomDiv" style="@moreContentBottomDiv.Style" @onmouseover="@(() => AddContentBottom())" @onscroll="@(() => AddContentBottom())" @onmousewheel="@(() => AddContentBottom())" @onpointerenter="@(() => AddContentBottom())" @ontouchenter="@(() => AddContentBottom())"></div> *@
@* </main> *@
@* *@
@* <CollectionSelector @ref="@cs" SelectedItem="@SelectedItem" SelectedItems="@SelectedItems" Header="@Header"/> *@
@* *@
@* <TwoChoiceInput @ref="@delPrompt" YesBtnClick="@DeleteSelected" NoBtnClick="@delPrompt.Disable" Message="@(SelectedItems.Count > 1 ? "Delete Selected Items?" : "Delete Selected Item?")"/> *@
@* <TwoChoiceInput @ref="@StarPrompt" YesBtnIcon="star" YesBtnText="Add" NoBtnIcon="star_outline" NoBtnText="Remove" YesBtnClick="@(() => UpdateStars(true))" NoBtnClick="@(() => UpdateStars(false))" Message="@(SelectedItems.Count > 1 ? "Add or remove stars for selected items?" : "Add or remove star for selected item?")"/> *@
@* *@
@* <ProgressPopUp @ref="@downloadPopUp" Message="Preparing Zip..."/> *@
@* *@
@* $1$Hotkeys exclusive to viewing a single item.#1# *@
@* @if (SelectedItem != Guid.Empty) *@
@* { *@
@* 	if (!MediaList[viewIndex].video) *@
@* 	{ *@
@* 		<KeyboardShortcuts Left="@ChangeItemLeft" Right="@ChangeItemRight"/> *@
@* 	} *@
@* *@
@* 	<KeyboardShortcuts AltLeft="@(() => SelectedItem = Guid.Empty)" CtrlLeft="@ChangeItemLeft" CtrlRight="@ChangeItemRight" CtrlE="@dateEdit.Toggle" *@
@* 		Esc="@(() => SelectedItem = Guid.Empty)" I="@info.Toggle" AltF="@editFilename.Toggle"/> *@
@* } *@
@* else *@
@* { *@
@* 	<CtrlGInput @ref=@ctrlGInput StartDateChanged="@StartDateChanged"/> *@
@* } *@
@* <KeyboardShortcuts AltS="@AltSFired" CtrlD="@DeleteBtnClick" Del="@DeleteBtnClick" Esc="@ClearChecks"/> *@
@* <ShortcutsReference DelText="Delete Selected Item(s)" CtrlDText="Delete Selected Item(s)" CtrlGText="Go to a Specific Point in Your Library" AltCText="Show/Hide CollectionSelector" AltSText="Add/Remove Star to Selected Item(s)"/> *@
@* *@
@* @code { *@
@* 	public CollectionSelector cs { get; private set; } = new(); *@
@* *@
@* 	private TwoChoiceInput delPrompt = new(); *@
@* 	public TwoChoiceInput StarPrompt { get; private set; } = new(); *@
@* 	 *@
@* 	private CtrlGInput ctrlGInput = new(); *@
@* *@
@* 	private ProgressPopUp? downloadPopUp; *@
@* 	 *@
@* 	///The query only used to select data on first page load. The query MUST SELECT these columns in this exact order: path, date_taken, date_added, starred, uuid, thumbnail, description. *@
@* 	[Parameter, EditorRequired] public string FirstQuery { get; set; } = null!; *@
@* 	 *@
@* 	///The query used to select add more content to the top of the page. The query MUST SELECT these columns in this exact order: path, date_taken, date_added, starred, uuid, thumbnail, description. *@
@* 	[Parameter, EditorRequired] public string NotNullDTQueryTop { get; set; } = null!; *@
@* 	 *@
@* 	///The query used to select add more content to the bottom of the page. The query MUST SELECT these columns in this exact order: path, date_taken, date_added, starred, uuid, thumbnail, description. *@
@* 	[Parameter, EditorRequired] public string NotNullDTQueryBottom { get; set; } = null!; *@
@* 	 *@
@* 	[Parameter, EditorRequired] public string NoItemsText { get; set; } = null!; *@
@* *@
@* 	[Parameter, EditorRequired] public Action Rerender { private get; set; } = null!; *@
@* 	 *@
@* 	[Parameter] public bool UseDateAdded { get; set; } *@
@* *@
@* 	///Used only for when viewing the contents of a collection. *@
@* 	[Parameter] public Collection? Collection { get; set; } *@
@* *@
@* 	public List<MediaRow> MediaList { get; private set; } = null!; *@
@* 	 *@
@* 	public HashSet<Guid> SelectedItems { get; private set; } = null!; *@
@* *@
@* 	private int previousDay, lastCheckedIndex; *@
@* 	 *@
@* 	private DateTime? oldestDT, newestDT; *@
@* 	 *@
@* 	private string? zipFilename; *@
@* 	 *@
@* 	private ElementVisibility moreContentTopDiv = new(), moreContentBottomDiv = new(), downloadPrompt = new(); *@
@* 	public ElementVisibility Header { get; private set; } = new(); *@
@* *@
@* 	private int selectedItemsCount; *@
@* 	public int SelectedItemsCount *@
@* 	{ *@
@* 		get => selectedItemsCount; *@
@* 		private set *@
@* 		{ *@
@* 			selectedItemsCount = value; *@
@* 			Rerender.Invoke(); *@
@* 		} *@
@* 	} *@
@* } *@
@* *@
@* $1$ Variables for viewing a single item in fullscreen. #1# *@
@* @code { *@
@* 	private int viewIndex; *@
@* 	 *@
@* 	private DateTime? newDateTaken; *@
@* 	private string? itemDescription; *@
@* 	private string newFilename = ""; *@
@* 	private readonly ElementVisibility editFilename = new(), filenameError = new(), dateEdit = new(), dtError = new(), info = new(); *@
@* 	private List<Collection>? collectionsIn; *@
@* *@
@* 	private Guid _selectedItem; *@
@* 	public Guid SelectedItem *@
@* 	{ *@
@* 		get => _selectedItem; *@
@* 		set *@
@* 		{ *@
@* 			_selectedItem = value; *@
@* 			if (value == Guid.Empty) *@
@* 			{ *@
@* 				newFilename = ""; *@
@* 				ElementVisibility.ChangeStates(false, editFilename, filenameError, dateEdit, dtError, info, downloadPrompt); *@
@* 			} *@
@* 			else *@
@* 			{ *@
@* 				newDateTaken = MediaList[viewIndex].dateTaken; *@
@* 				newFilename = Path.GetFileNameWithoutExtension(MediaList[viewIndex].path); *@
@* 				collectionsIn = C.GetCollectionsContaining(SelectedItem); *@
@* 				itemDescription = MediaList[viewIndex].description; *@
@* 			} *@
@* 			StateHasChanged(); *@
@* 		} *@
@* 	} *@
@* } *@
@* *@
@* @functions  { *@
@* 	protected override void OnInitialized() *@
@* 	{ *@
@* 		downloadPrompt.Rerender = StateHasChanged; *@
@* 		Header.Rerender = Rerender; *@
@* 		info.Rerender = StateHasChanged; *@
@* 		Reset(); *@
@* 	} *@
@* *@
@* 	///Modifies a checkmark's CSS class to show if checked/unchecked, and adds/removes the uuid from SelectedItems. *@
@* 	private async Task ToggleCheck(Guid uuid) *@
@* 	{ *@
@* 		string newClass = await JSRuntime.InvokeAsync<string>("toggleCheck", uuid); *@
@* 		if (newClass.Contains("unchecked")) *@
@* 			SelectedItems.Remove(uuid); *@
@* 		else *@
@* 			SelectedItems.Add(uuid); *@
@* 		SelectedItemsCount = SelectedItems.Count; *@
@* 	} *@
@* *@
@* 	///<summary>Adds content either to the front or back of MediaList.</summary> *@
@* 	///<param name="firstQuery">The query to be used when oldestOrNewestDT is null. This is used when the page is first loaded.</param> *@
@* 	///<param name="notNullDTQuery">The query to be used when oldestOrNewestDT is NOT null. This is used after the page has content and needs more either at the top or bottom of the page. Use &lt; for getting content older than the oldest DT, and &gt; for getting content newer than the newest DT.</param> *@
@* 	///<param name="oldestOrNewestDT">The DateTime tracking the oldest or newest DT so far, for adding more content.</param> *@
@* 	///<param name="bottom">If true, adding items to the end of the List. If false, adding items to the front of the List.</param> *@
@* 	///<param name="moreContentDiv">The variable controlling the visibility of the div for adding more content.</param> *@
@* 	///<returns>The amount of items added to MediaList (0 if none or an error).</returns> *@
@* 	///<remarks>The query MUST SELECT these columns in this exact order: path, date_taken, date_added, starred, uuid, thumbnail, description.</remarks> *@
@* 	private int AddContent(string firstQuery, string notNullDTQuery, ref DateTime? oldestOrNewestDT, bool bottom, ElementVisibility moreContentDiv) *@
@* 	{ *@
@* 		if (String.IsNullOrWhiteSpace(firstQuery) || String.IsNullOrWhiteSpace(notNullDTQuery)) *@
@* 		{ *@
@* 			moreContentDiv.Disable(); *@
@* 			return 0; *@
@* 		} *@
@* *@
@* 		int amountAdded = 0; *@
@* 		 *@
@* 		try *@
@* 		{ *@
@* 			C.Open(); *@
@* 			using NpgsqlCommand cmd = new(null, C.connection); *@
@* 			if (oldestOrNewestDT == null) //Only possible when page first loads and there's no content yet. *@
@* 			{ *@
@* 				cmd.CommandText = firstQuery; *@
@* 			} *@
@* 			else *@
@* 			{ *@
@* 				cmd.CommandText = notNullDTQuery; *@
@* 				cmd.Parameters.AddWithValue("@oldestOrNewestDT", oldestOrNewestDT); *@
@* 			} *@
@* 			using NpgsqlDataReader r = cmd.ExecuteReader(); *@
@* 			while (r.Read()) *@
@* 			{ *@
@* 				MediaRow newRow = new(r.GetString(0), r.IsDBNull(1) ? null : r.GetDateTime(1), r.GetDateTime(2), r.GetBoolean(3), r.GetGuid(4), r.GetString(5), r.IsDBNull(6) ? null : r.GetString(6)); *@
@* 				if (!MediaList.Contains(newRow)) *@
@* 				{ *@
@* 					if (bottom) MediaList.Add(newRow); *@
@* 					else MediaList.Insert(0, newRow); *@
@* 					amountAdded++; *@
@* 				} *@
@* 			} *@
@* 			r.Close(); *@
@* 			 *@
@* 			if (MediaList.Count > 0) *@
@* 			{ *@
@* 				if (UseDateAdded) oldestOrNewestDT = bottom ? MediaList.Last().dateAdded : MediaList.First().dateAdded; *@
@* 				else oldestOrNewestDT = bottom ? MediaList.Last().dateTaken : MediaList.First().dateTaken; *@
@* 			} *@
@* 		} *@
@* 		catch (NpgsqlException e) *@
@* 		{ *@
@* 			L.LogException(e); *@
@* 		} *@
@* 		finally *@
@* 		{ *@
@* 			C.Close(); *@
@* 		} *@
@* 		 *@
@* 		//If there is no more content available to display, hide the div so user can click through it to click any items below the div. *@
@* 		if (amountAdded == 0) moreContentDiv.Disable(); *@
@* 		return amountAdded; *@
@* 	} *@
@* 	 *@
@* 	///Adds content to the front of MediaList when user hovers over top of page after using Ctrl G. Returns how many items were added (0 if none or error occurred). *@
@* 	public int AddContentTop() => AddContent(FirstQuery, NotNullDTQueryTop, ref newestDT, false, moreContentTopDiv); *@
@* *@
@* 	///Adds content to the end of MediaList when user hovers over bottom of page. Returns how many items were added (0 if none or error occurred). *@
@* 	public int AddContentBottom() => AddContent(FirstQuery, NotNullDTQueryBottom, ref oldestDT, true, moreContentBottomDiv); *@
@* *@
@* 	///Called when the check for an item is clicked, or when an item is clicked and Ctrl is down or there is at least 1 item selected. Toggles that item's check, or multiple items if Shift is held down. *@
@* 	private async Task CheckClicked(Guid uuid, MouseEventArgs eventArgs) *@
@* 	{ *@
@* 		await ToggleCheck(uuid); *@
@* 		int thisIndex = Int32.Parse(await JSRuntime.InvokeAsync<string>("getItemId", uuid)); *@
@* *@
@* 		//Get if Shift was held down when clicking the checkbox. Used for selecting multiple items. *@
@* 		if (eventArgs.ShiftKey) *@
@* 		{ *@
@* 			//First item is on left and item shift clicked is on the right. E.g., ###1####2### Loop from 1 --> 2, and add stuff in between to SelectedItems. *@
@* 			if (lastCheckedIndex < thisIndex) *@
@* 				await AddSelected(lastCheckedIndex, thisIndex); *@
@* 			else if (lastCheckedIndex > thisIndex) //Same as above but swap 1 and 2 and the direction. *@
@* 				await AddSelected(thisIndex, lastCheckedIndex); *@
@* 		} *@
@* 		else *@
@* 		{ *@
@* 			lastCheckedIndex = thisIndex; *@
@* 		} *@
@* 		 *@
@* 		Header.Visible = SelectedItems.Count > 0; *@
@* 		SelectedItemsCount = SelectedItems.Count; *@
@* 	 *@
@* 		//Add items from start to end into SelectedItems. Used for Shift Click. *@
@* 		async Task AddSelected(int startIndex, int endIndex) *@
@* 		{ *@
@* 			for (int i = startIndex; i <= endIndex; i++) *@
@* 			{ *@
@* 				Guid currentID = MediaList[i].uuid; *@
@* 				if (SelectedItems.Contains(currentID)) continue; *@
@* 				await ToggleCheck(currentID); *@
@* 			} *@
@* 		} *@
@* 	} *@
@* 	 *@
@* 	///Called when an &lt;img/&gt; is clicked. Either checks this item, or shows it in fullscreen. *@
@* 	private async Task ImgClicked(Guid uuid, int index, MouseEventArgs eventArgs) *@
@* 	{ *@
@* 		if (SelectedItems.Count > 0 || eventArgs.CtrlKey) *@
@* 			await CheckClicked(uuid, eventArgs); *@
@* 		else //Show this item in fullscreen. *@
@* 		{ *@
@* 			viewIndex = index; *@
@* 			SelectedItem = uuid; *@
@* 		} *@
@* 	} *@
@* 	 *@
@* 	public async void ClearChecks() *@
@* 	{ *@
@* 		foreach (Guid item in SelectedItems) *@
@* 			await JSRuntime.InvokeAsync<string>("removeCheck", item); *@
@* 		SelectedItems.Clear(); *@
@* 		ElementVisibility.ChangeStates(false, Header, delPrompt.Visibility, StarPrompt.Visibility); *@
@* 		SelectedItemsCount = 0; *@
@* 		StateHasChanged(); *@
@* 	} *@
@* 	 *@
@* 	///Shows the TwoChoiceInput if enabled. If not, then deletes the selected items. *@
@* 	public void DeleteBtnClick() *@
@* 	{ *@
@* 		if (SelectedItem == Guid.Empty && SelectedItems.Count == 0) return; *@
@* 		if (S.showPrompts == false) *@
@* 		{ *@
@* 			DeleteSelected(); *@
@* 			return; *@
@* 		} *@
@* 		delPrompt.Enable(); *@
@* 		StateHasChanged(); *@
@* 	} *@
@* *@
@* 	private void StarBtnClick() *@
@* 	{ *@
@* 		MediaList[viewIndex].starred = !MediaList[viewIndex].starred; *@
@* 		C.UpdateStarred(MediaList[viewIndex].uuid, MediaList[viewIndex].starred); *@
@* 	} *@
@* *@
@* 	///Called when description textarea's focus is lost. Updates the item's description, if it's been updated. *@
@* 	private void UpdateDescription() *@
@* 	{ *@
@* 		if (MediaList[viewIndex].description != itemDescription) *@
@* 		{ *@
@* 			MediaList[viewIndex].description = itemDescription; *@
@* 			C.UpdateDescription(_selectedItem, itemDescription); *@
@* 		} *@
@* 	} *@
@* *@
@* 	///Deletes all selected items. *@
@* 	private void DeleteSelected() *@
@* 	{ *@
@* 		if (SelectedItem != Guid.Empty) *@
@* 		{ *@
@* 			SelectedItem = MediaList.Count > 0 ? MediaList[viewIndex].uuid : Guid.Empty; *@
@* 			C.MoveToTrash(SelectedItem); *@
@* 			MediaList.RemoveAt(viewIndex); *@
@* 		} *@
@* 		else *@
@* 		{ *@
@* 			foreach (Guid item in SelectedItems) *@
@* 			{ *@
@* 				C.MoveToTrash(item); *@
@* 				MediaList.RemoveAll(u => u.uuid == item); *@
@* 			} *@
@* 		} *@
@* *@
@* 		delPrompt.Disable(); *@
@* 		ClearChecks(); *@
@* 		StateHasChanged(); *@
@* 	} *@
@* *@
@* 	///Either toggles the SelectedItem's starred field, or shows the Star Prompt. *@
@* 	private void AltSFired() *@
@* 	{ *@
@* 		if (SelectedItem == Guid.Empty && SelectedItems.Count > 0) *@
@* 		{ *@
@* 			StarPrompt.Toggle(); *@
@* 			StateHasChanged(); *@
@* 		} *@
@* 		else if (SelectedItem != Guid.Empty) *@
@* 		{ *@
@* 			C.UpdateStarred(SelectedItem, !MediaList[viewIndex].starred); *@
@* 			MediaList[viewIndex].starred = !MediaList[viewIndex].starred; *@
@* 			StateHasChanged(); *@
@* 		} *@
@* 	} *@
@* *@
@* 	///Updates the 'starred' field in the DB and the List for the SelectedItems. *@
@* 	public void UpdateStars(bool starred) *@
@* 	{ *@
@* 		C.UpdateStarred(SelectedItems, starred); *@
@* 		StarPrompt.Disable(); *@
@* *@
@* 		foreach (MediaRow item in MediaList) *@
@* 			if (SelectedItems.Contains(item.uuid)) *@
@* 				item.starred = starred; *@
@* *@
@* 		ClearChecks(); *@
@* 	} *@
@* 	 *@
@* 	///Creates a .zip file for downloading the items the user wants to download. *@
@* 	public async void DownloadSelected() *@
@* 	{ *@
@* 		if (SelectedItems.Count == 0) return; *@
@* 		 *@
@* 		downloadPopUp!.Enable(); *@
@* 		Header.Disable(); *@
@* 		await InvokeAsync(StateHasChanged); *@
@* 		await Task.Delay(0); *@
@* 		await Task.Delay(1); *@
@* *@
@* 		string zipFolderPath = Path.Combine(S.tmpFolderPath, $"Download {Guid.NewGuid()}"); *@
@* 		Directory.CreateDirectory(zipFolderPath); *@
@* *@
@* 		foreach (string shortPath in from media in MediaList where SelectedItems.Contains(media.uuid) select media.path) *@
@* 		{ *@
@* 			string fullPath = Path.Combine(S.libFolderPath, shortPath); *@
@* 			string destPath = Path.Combine(zipFolderPath, Path.GetFileName(shortPath)); *@
@* 			File.Copy(fullPath, destPath); *@
@* 		} *@
@* *@
@* 		ClearChecks(); *@
@* 		 *@
@* 		zipFilename = $"MM Download {DateTime.Now:M-d-yyyy h;mm;ss tt}.zip"; *@
@* 		string zipFilePath = Path.Combine(S.tmpFolderPath, zipFilename); *@
@* 		ZipFile.CreateFromDirectory(zipFolderPath, zipFilePath, CompressionLevel.Fastest, false); *@
@* 		 *@
@* 		downloadPopUp.Disable(); *@
@* 		downloadPrompt.Enable(); *@
@* 		await InvokeAsync(StateHasChanged); *@
@* *@
@* 		Directory.Delete(zipFolderPath, true); //Not needed after it's zipped. *@
@* 		 *@
@* 		navigationManager.NavigateTo($"mm_tmp/{zipFilename}", true); *@
@* 	} *@
@* *@
@* 	public void Reset() *@
@* 	{ *@
@* 		MediaList = new List<MediaRow>(150); *@
@* 		_selectedItem = Guid.Empty; *@
@* 		SelectedItems = new HashSet<Guid>(150); *@
@* 		oldestDT = newestDT = null; *@
@* 		AddContentBottom(); *@
@* 		if (MediaList.Count > 0) *@
@* 		{ *@
@* 			if (UseDateAdded) *@
@* 			{ *@
@* 				oldestDT = MediaList.Last().dateAdded; *@
@* 				newestDT = MediaList.First().dateAdded; *@
@* 			} *@
@* 			else *@
@* 			{ *@
@* 				oldestDT = MediaList.Last().dateTaken; *@
@* 				newestDT = MediaList.First().dateTaken;				 *@
@* 			} *@
@* 		} *@
@* 		moreContentBottomDiv.Enable(); *@
@* 		ElementVisibility.ChangeStates(false, moreContentTopDiv, delPrompt.Visibility, info, dtError, dateEdit, editFilename, filenameError, downloadPrompt); *@
@* 		downloadPopUp?.Disable(); *@
@* 		viewIndex = 0; *@
@* 		itemDescription = ""; *@
@* 	} *@
@* } *@
@* *@
@* $1$ Functions only for viewing a single item. #1# *@
@* @functions { *@
@* 	private void UpdateDateTaken() *@
@* 	{ *@
@* 		if (C.UpdateDateTaken(MediaList[viewIndex].path, newDateTaken)) *@
@* 		{ *@
@* 			dateEdit.Disable(); *@
@* 			MediaList[viewIndex].dateTaken = newDateTaken; *@
@* 		} *@
@* 		else *@
@* 		{ *@
@* 			dtError.Enable(); *@
@* 		} *@
@* 	} *@
@* *@
@* 	private void RenameFile() *@
@* 	{ *@
@* 		GC.Collect(); //Those damn videos always stirring up trouble. *@
@* 		GC.WaitForPendingFinalizers(); *@
@* 		string? result = C.RenameFile(MediaList[viewIndex].path, newFilename, Path.GetExtension(MediaList[viewIndex].path), MediaList[viewIndex].dateTaken); *@
@* 		if (result == null) *@
@* 		{ *@
@* 			filenameError.Enable(); *@
@* 		} *@
@* 		else *@
@* 		{ *@
@* 			editFilename.Disable(); *@
@* 			MediaList[viewIndex].path = result; *@
@* 		} *@
@* 	} *@
@* *@
@* 	private void ChangeItemLeft() *@
@* 	{ *@
@* 		//Last item so try adding more. If no more content can be added, return. *@
@* 		if (viewIndex == 0) *@
@* 		{ *@
@* 			viewIndex = AddContentTop(); *@
@* 			if (viewIndex == 0) return; *@
@* 		} *@
@* 		else viewIndex--; *@
@* 		SelectedItem = MediaList[viewIndex].uuid; *@
@* 	} *@
@* *@
@* 	private void ChangeItemRight() *@
@* 	{ *@
@* 		//Last item so try adding more. If no more content can be added, return. *@
@* 		if (viewIndex == MediaList.Count - 1) *@
@* 		{ *@
@* 			if (AddContentBottom() == 0) return; *@
@* 		} *@
@* 		viewIndex++; *@
@* 		SelectedItem = MediaList[viewIndex].uuid; *@
@* 	} *@
@* *@
@* 	///Used with Ctrl G to set the new start date for LCV. Resets LCV to that date. *@
@* 	private async void StartDateChanged() *@
@* 	{ *@
@* 		oldestDT = newestDT = ctrlGInput.NewStartDate; *@
@* 		MediaList.Clear(); *@
@* 		ClearChecks(); *@
@* 		moreContentTopDiv.Enable(); *@
@* 		StateHasChanged(); *@
@* 		 *@
@* 		AddContentTop(); *@
@* 		AddContentBottom(); *@
@* 		StateHasChanged(); *@
@* 		await Task.Delay(0); *@
@* 		await Task.Delay(1); *@
@* 	} *@
@* } *@